# 白板DDS同步功能使用指南

## 🎯 功能概述

本项目实现了基于DDS（Data Distribution Service）的实时白板同步功能，支持：

- ✅ 实时元素同步（创建、修改、删除）
- ✅ 冲突检测和解决
- ✅ 多用户协作
- ✅ 局域网自动发现
- ✅ 断线重连

## 🚀 快速开始

### 1. 启动应用

```bash
# 方法1：使用测试脚本（推荐）
./test_whiteboard_sync.sh

# 方法2：手动启动
npm run dev
```

### 2. 测试同步功能

1. **单机测试**：打开多个浏览器窗口访问 `http://localhost:4200`
2. **多机测试**：在局域网内的不同设备上访问应用
3. **操作测试**：
   - 创建几何图形（矩形、圆形、线条等）
   - 拖动和调整图形大小
   - 添加和编辑文本
   - 删除元素
   - 观察其他窗口的实时同步效果

## 📊 监控和调试

### 前端监控

- **连接状态**：查看白板标题栏的连接指示器
  - 🟢 DDS已连接：支持多用户同步
  - 🟡 仅本地模式：DDS未连接，仅本地操作

- **操作日志**：右侧面板显示详细的操作记录
  - 🔧 本地操作：当前用户的操作
  - 📡 远程操作：其他用户的操作
  - 📤 DDS发布：成功发布到网络
  - ❌ 错误信息：连接或同步失败

### 后端监控

```bash
# 查看DDS订阅者日志
cd dds_subscriber
cargo run -- listen --verbose

# 查看应用后端日志
# 在应用启动时会显示详细的DDS连接和操作信息
```

## ⚙️ 配置选项

### DDS配置

- **域ID**：150（在 `src-tauri/src/dds_manager.rs` 中配置）
- **主题名称**："DrawnixBoardChanges"
- **QoS配置**：参见 `ZRDDS_QOS_PROFILES.xml`

### 冲突检测配置

- **清理间隔**：60秒（自动清理过期的冲突检测缓存）
- **冲突策略**：时间戳优先 + 路径冲突检测

## 🔧 故障排除

### 常见问题

1. **DDS连接失败**
   ```
   ⚠️ DDS 初始化失败，将仅使用本地模式
   ```
   - 检查ZRDDS中间件是否正确安装
   - 确认防火墙设置允许DDS通信
   - 检查网络连接

2. **同步延迟**
   - 正常情况下延迟应在100ms以内
   - 如果延迟过高，检查网络质量
   - 可以调整DDS QoS配置优化性能

3. **冲突频繁**
   ```
   ⚠️ 检测到时间戳冲突
   ⚠️ 检测到路径冲突
   ```
   - 这是正常现象，系统会自动解决
   - 如果冲突过于频繁，建议用户协调操作

### 调试模式

```bash
# 启用详细日志
RUST_LOG=debug npm run dev

# 查看DDS网络流量
cd dds_subscriber
cargo run -- listen --verbose --raw
```

## 🏗️ 架构说明